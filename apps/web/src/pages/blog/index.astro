---
import BaseLayout from '../../components/layout/BaseLayout.astro';
import Container from '../../components/ui/Container.astro';
import PostCard from '../../components/blog/PostCard.astro';
import { getAllPosts } from '../../lib/sanity';

let posts = [];

try {
  posts = await getAllPosts();
} catch (error) {
  console.error('Error fetching posts:', error);
}

// Coming Soon placeholder posts
const comingSoonPosts = [
  {
    title: 'Designing Payment Systems That Don\'t Lose Money',
    description: 'Lessons from building transaction processing systems with proper idempotency, reconciliation, and failure handling.',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />`,
  },
  {
    title: 'Event-Driven Architectures in Real Fintech Products',
    description: 'Practical patterns for queues, workers, and async processing in production payment systems.',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />`,
  },
  {
    title: 'Lessons from Re-Architecting Legacy Systems',
    description: 'How to incrementally modernize a running system without breaking what already works.',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 7.5 12 2.25l9.75 5.25-4.179 2.25m0 0L21.75 12l-4.179 2.25m0 0l4.179 2.25L12 21.75 2.25 16.5l4.179-2.25m11.142 0l-5.571 3-5.571-3" />`,
  },
];
---

<BaseLayout
  title="Blog"
  description="Articles on backend systems, payments, and production engineering."
>
  <section class="py-12">
    <Container>
      <div class="mb-8">
        <h1 class="text-2xl md:text-3xl font-bold text-text mb-2">Writing</h1>
        <p class="text-sm text-muted">Thoughts on backend systems, payments, and production engineering.</p>
      </div>

      {posts.length > 0 ? (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
          {posts.map((post) => (
            <PostCard post={post} />
          ))}
        </div>
      ) : (
        <div class="grid md:grid-cols-3 gap-4">
          {comingSoonPosts.map((post) => (
            <div class="card-interactive p-5 group">
              <div class="flex items-start gap-3 mb-3">
                <div class="flex-shrink-0 w-8 h-8 rounded-md bg-panel-2 flex items-center justify-center">
                  <svg
                    class="w-4 h-4 text-muted"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    set:html={post.icon}
                  />
                </div>
                <span class="inline-block text-[10px] font-medium text-muted bg-panel-2 px-2 py-0.5 rounded">Coming Soon</span>
              </div>
              <h3 class="text-sm font-semibold text-text mb-2">{post.title}</h3>
              <p class="text-xs text-muted leading-relaxed">{post.description}</p>
            </div>
          ))}
        </div>
      )}
    </Container>
  </section>
</BaseLayout>
