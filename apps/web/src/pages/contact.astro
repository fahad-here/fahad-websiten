---
import BaseLayout from '../components/layout/BaseLayout.astro';
import Container from '../components/ui/Container.astro';

const reasons = [
  { text: 'Architecture reviews', icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 7.5 12 2.25l9.75 5.25-4.179 2.25m0 0L21.75 12l-4.179 2.25m0 0l4.179 2.25L12 21.75 2.25 16.5l4.179-2.25m11.142 0l-5.571 3-5.571-3" />` },
  { text: 'Payment systems', icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />` },
  { text: 'Production issues', icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />` },
  { text: 'Technical consulting', icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155" />` },
];

const contactMethods = [
  {
    label: 'Email',
    value: 'fmohajir@gmail.com',
    href: 'mailto:fmohajir@gmail.com',
    icon: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />`,
  },
  {
    label: 'LinkedIn',
    value: 'Connect on LinkedIn',
    href: 'https://www.linkedin.com/in/mohammed-fahad-29a988165',
    icon: `<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />`,
    fill: true,
  },
  {
    label: 'GitHub',
    value: 'View my work',
    href: 'https://github.com/fahad-here',
    icon: `<path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z" />`,
    fill: true,
  },
];
---

<BaseLayout
  title="Contact"
  description="Get in touch for fintech development, backend architecture, or consulting opportunities."
>
  <section class="py-16 md:py-24">
    <Container>
      <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
          <h1 class="text-2xl md:text-3xl font-bold text-text mb-3">Let's talk</h1>
          <p class="text-muted max-w-md mx-auto">
            Whether you need help with a specific problem or want to discuss a longer engagement.
          </p>
        </div>

        <!-- Why reach out -->
        <div class="mb-12">
          <p class="text-xs font-medium uppercase tracking-wider text-muted text-center mb-4">Good reasons to reach out</p>
          <div class="flex flex-wrap justify-center gap-3">
            {reasons.map((reason) => (
              <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-panel border border-border rounded-full text-sm text-text">
                <svg
                  class="w-4 h-4 text-muted"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  set:html={reason.icon}
                />
                {reason.text}
              </div>
            ))}
          </div>
        </div>

        <!-- Two column layout on larger screens -->
        <div class="grid lg:grid-cols-5 gap-8 lg:gap-12">
          <!-- Form -->
          <div class="lg:col-span-3">
            <form
              id="contact-form"
              name="contact"
              method="POST"
              action="/thanks"
              data-netlify="true"
              netlify-honeypot="bot-field"
              class="contact-form card-interactive-subtle p-6 md:p-8"
            >
              <!-- Required for Netlify form detection -->
              <input type="hidden" name="form-name" value="contact" />

              <!-- Honeypot field for spam prevention -->
              <p class="sr-only">
                <label>Don't fill this out if you're human: <input name="bot-field" /></label>
              </p>

              <!-- Form fields -->
              <div id="form-fields" class="space-y-6">
                <div>
                  <label for="name" class="block text-sm font-medium text-text mb-2">Name</label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    autocomplete="name"
                    class="contact-input w-full"
                    placeholder="Your name"
                  />
                </div>

                <div>
                  <label for="email" class="block text-sm font-medium text-text mb-2">Email</label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    autocomplete="email"
                    class="contact-input w-full"
                    placeholder="you@company.com"
                  />
                </div>

                <div>
                  <label for="message" class="block text-sm font-medium text-text mb-2">Message</label>
                  <textarea
                    id="message"
                    name="message"
                    rows="5"
                    required
                    class="contact-input w-full resize-none"
                    placeholder="What can I help you with?"
                  ></textarea>
                </div>

                <button
                  type="submit"
                  class="submit-btn w-full inline-flex items-center justify-center gap-2 px-6 py-3.5 rounded-lg font-medium text-bg bg-primary hover:bg-primary-2 transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-bg"
                >
                  <span>Send message</span>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                  </svg>
                </button>
              </div>

              <!-- Success state -->
              <div id="form-success" class="hidden text-center py-8">
                <div class="w-12 h-12 rounded-full bg-success/10 flex items-center justify-center mx-auto mb-4">
                  <svg class="w-6 h-6 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-text mb-2">Thanks for reaching out</h3>
                <p class="text-sm text-muted">Your message has been sent. I'll get back to you soon.</p>
              </div>

              <!-- Error state -->
              <div id="form-error" class="hidden text-center py-8">
                <div class="w-12 h-12 rounded-full bg-warning/10 flex items-center justify-center mx-auto mb-4">
                  <svg class="w-6 h-6 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-text mb-2">Something didn't go through</h3>
                <p class="text-sm text-muted mb-4">You can reach me directly via email or LinkedIn.</p>
                <a
                  href="mailto:fmohajir@gmail.com"
                  class="inline-flex items-center gap-2 text-sm text-primary hover:underline"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                  </svg>
                  fmohajir@gmail.com
                </a>
              </div>
            </form>
          </div>

          <!-- Alternate contact methods -->
          <div class="lg:col-span-2">
            <div class="sticky top-24">
              <p class="text-xs font-medium uppercase tracking-wider text-muted mb-4">Or reach out directly</p>

              <div class="space-y-3">
                {contactMethods.map((method) => (
                  <a
                    href={method.href}
                    target={method.href.startsWith('mailto') ? undefined : '_blank'}
                    rel={method.href.startsWith('mailto') ? undefined : 'noopener noreferrer'}
                    class="contact-method group card-interactive-subtle flex items-center gap-4 p-4"
                  >
                    <div class="w-10 h-10 rounded-lg bg-bg border border-border flex items-center justify-center transition-colors">
                      <svg
                        class="w-5 h-5 text-muted group-hover:text-primary transition-colors"
                        fill={method.fill ? 'currentColor' : 'none'}
                        stroke={method.fill ? 'none' : 'currentColor'}
                        viewBox="0 0 24 24"
                        set:html={method.icon}
                      />
                    </div>
                    <div>
                      <span class="block text-xs text-muted">{method.label}</span>
                      <span class="block text-sm text-text group-hover:text-primary transition-colors">{method.value}</span>
                    </div>
                  </a>
                ))}
              </div>

              <!-- Response time note -->
              <p class="text-xs text-muted mt-6 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Typically respond within 24 hours
              </p>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </section>
</BaseLayout>

<style>
  .contact-input {
    @apply px-4 py-3 text-sm text-text placeholder-muted;
    @apply bg-bg border border-border rounded-lg;
    @apply transition-all duration-200;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .contact-input:focus {
    @apply outline-none;
    border-color: rgb(var(--primary-rgb) / 0.5);
    box-shadow: 0 0 0 3px var(--ring), inset 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .contact-input:hover:not(:focus) {
    border-color: rgb(var(--primary-rgb) / 0.15);
  }

  /* Validation states */
  .contact-input:invalid:not(:placeholder-shown):not(:focus) {
    border-color: rgb(var(--primary-rgb) / 0.3);
  }

  .contact-method:hover {
    transform: translateX(4px) translateY(-1px);
  }

  @media (prefers-reduced-motion: reduce) {
    .contact-method:hover {
      transform: none;
    }
  }
</style>

<script>
  /**
   * Contact Form Handler
   *
   * Progressive enhancement for the contact form.
   * Without JavaScript: form submits normally via POST and redirects to /thanks.
   * With JavaScript: submits via fetch and shows inline success/error state.
   */
  function initContactForm() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    if (!form) return;

    const formFields = document.getElementById('form-fields');
    const successState = document.getElementById('form-success');
    const errorState = document.getElementById('form-error');
    const submitBtn = form.querySelector('.submit-btn') as HTMLButtonElement;

    // Show a specific state
    function showState(state: 'fields' | 'success' | 'error') {
      formFields?.classList.toggle('hidden', state !== 'fields');
      successState?.classList.toggle('hidden', state !== 'success');
      errorState?.classList.toggle('hidden', state !== 'error');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Check honeypot
      const honeypot = form.querySelector('input[name="bot-field"]') as HTMLInputElement;
      if (honeypot?.value) {
        // Bot detected, silently show success
        showState('success');
        return;
      }

      // Disable submit button during submission
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
      }

      const formData = new FormData(form);

      try {
        // Submit to Netlify (or any form handler)
        const response = await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams(formData as any).toString(),
        });

        if (response.ok) {
          showState('success');
        } else {
          showState('error');
        }
      } catch (error) {
        // Network error or submission failed
        showState('error');
      } finally {
        // Re-enable button in case user wants to retry
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = `
            <span>Send message</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          `;
        }
      }
    });
  }

  // Initialize on page load and after Astro page transitions
  initContactForm();
  document.addEventListener('astro:after-swap', initContactForm);
</script>
