---
import { urlFor } from '../../lib/image';
import type { SanityImage } from '../../types';

interface Props {
  value: SanityImage & {
    caption?: string;
  };
}

const { value } = Astro.props;

// Generate responsive image URLs
const imageUrl = urlFor(value)?.width(800).quality(85).url();
const imageUrlLarge = urlFor(value)?.width(1200).quality(85).url();
const imageUrlSmall = urlFor(value)?.width(400).quality(80).url();

const alt = value.alt || '';
const caption = value.caption;
---

{imageUrl && (
  <figure class="my-8">
    <div class="overflow-hidden rounded-lg border border-border">
      <img
        src={imageUrl}
        srcset={`${imageUrlSmall} 400w, ${imageUrl} 800w, ${imageUrlLarge} 1200w`}
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 800px, 1200px"
        alt={alt}
        loading="lazy"
        decoding="async"
        class="w-full h-auto"
      />
    </div>
    {caption && (
      <figcaption class="mt-3 text-center text-sm text-muted">
        {caption}
      </figcaption>
    )}
  </figure>
)}
