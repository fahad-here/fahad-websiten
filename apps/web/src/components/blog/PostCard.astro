---
import Card from '../ui/Card.astro';
import Badge from '../ui/Badge.astro';
import { getImageUrl } from '../../lib/image';
import type { Post } from '../../types';

interface Props {
  post: Post;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const imageUrl = getImageUrl(post.coverImage, { width: 600, height: 400 });

const formattedDate = new Date(post.publishedAt).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Card href={`/blog/${post.slug.current}`} class={featured ? 'md:col-span-2' : ''}>
  {imageUrl && (
    <div class:list={['bg-panel overflow-hidden', featured ? 'aspect-[21/9]' : 'aspect-video']}>
      <img
        src={imageUrl}
        alt={post.coverImage?.alt || post.title}
        class="w-full h-full object-cover"
        loading="lazy"
      />
    </div>
  )}
  {!imageUrl && (
    <div class:list={['bg-gradient-to-br from-accent/20 to-accent/5 flex items-center justify-center', featured ? 'aspect-[21/9]' : 'aspect-video']}>
      <span class="text-accent/50 text-4xl font-bold">{post.title.charAt(0)}</span>
    </div>
  )}
  <div class="p-6">
    <div class="flex items-center gap-3 text-sm text-muted mb-3">
      <time datetime={post.publishedAt}>{formattedDate}</time>
      {post.readingTime && (
        <>
          <span class="text-border">|</span>
          <span>{post.readingTime} min read</span>
        </>
      )}
    </div>
    <h3 class:list={['font-semibold text-text mb-2', featured ? 'text-2xl' : 'text-xl']}>
      {post.title}
    </h3>
    <p class="text-muted text-sm mb-4 line-clamp-2">{post.excerpt}</p>
    {post.categories && post.categories.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {post.categories.slice(0, 3).map((category) => (
          <Badge>{category}</Badge>
        ))}
      </div>
    )}
  </div>
</Card>
