---
import Badge from '../ui/Badge.astro';
import { getImageUrl } from '../../lib/image';
import type { CaseStudy } from '../../types';

interface Props {
  caseStudy: CaseStudy;
}

const { caseStudy } = Astro.props;
const imageUrl = getImageUrl(caseStudy.coverImage, { width: 600, height: 400 });

// Generate a consistent gradient based on title
const gradients = [
  'from-cyan-500/20 to-blue-600/20',
  'from-purple-500/20 to-pink-600/20',
  'from-emerald-500/20 to-teal-600/20',
  'from-orange-500/20 to-red-600/20',
  'from-indigo-500/20 to-violet-600/20',
];
const gradientIndex = caseStudy.title.length % gradients.length;
const gradient = gradients[gradientIndex];
---

<a
  href={`/work/${caseStudy.slug.current}`}
  class="block card-interactive overflow-hidden group"
>
  {imageUrl ? (
    <div class="aspect-video bg-panel-2 overflow-hidden">
      <img
        src={imageUrl}
        alt={caseStudy.coverImage?.alt || caseStudy.title}
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
    </div>
  ) : (
    <div class={`relative h-28 bg-gradient-to-br ${gradient} flex items-center justify-center overflow-hidden`}>
      {/* Grid pattern overlay */}
      <div class="absolute inset-0 opacity-10" style="background-image: linear-gradient(var(--text) 1px, transparent 1px), linear-gradient(90deg, var(--text) 1px, transparent 1px); background-size: 20px 20px;"></div>

      {/* Letter badge */}
      <div class="relative w-12 h-12 rounded-xl bg-panel/80 backdrop-blur border border-border flex items-center justify-center group-hover:scale-105 transition-transform">
        <span class="text-lg font-bold text-primary">{caseStudy.title.charAt(0)}</span>
      </div>

      {/* Decorative elements */}
      <div class="absolute top-3 left-3 w-2 h-2 rounded-full bg-primary/40"></div>
      <div class="absolute bottom-3 right-3 w-1.5 h-1.5 rounded-full bg-secondary/40"></div>
      <div class="absolute top-1/2 right-6 w-8 h-px bg-border/50"></div>
      <div class="absolute bottom-8 left-6 w-6 h-px bg-border/50"></div>
    </div>
  )}

  <div class="p-5">
    <h3 class="text-sm font-semibold text-text mb-3">{caseStudy.title}</h3>
    {caseStudy.problem && (
      <div class="mb-2">
        <span class="text-[10px] font-medium text-muted uppercase tracking-wide">Problem</span>
        <p class="text-xs text-text-2 mt-0.5 line-clamp-2">{caseStudy.problem}</p>
      </div>
    )}
    {caseStudy.outcome && (
      <div class="mb-3">
        <span class="text-[10px] font-medium text-muted uppercase tracking-wide">Outcome</span>
        <p class="text-xs text-text-2 mt-0.5 line-clamp-2">{caseStudy.outcome}</p>
      </div>
    )}
    {!caseStudy.problem && !caseStudy.outcome && caseStudy.summary && (
      <p class="text-xs text-muted mb-3 line-clamp-2">{caseStudy.summary}</p>
    )}
    <div class="flex flex-wrap gap-1">
      {caseStudy.stack?.slice(0, 4).map((tech) => (
        <Badge size="sm">{tech}</Badge>
      ))}
    </div>
  </div>
</a>
